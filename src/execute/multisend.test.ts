import { expect, describe, it } from 'bun:test'
import { OperationType } from '@safe-global/types-kit'

import { encodeMultiSend } from './multisend'

describe('multisend', () => {
  describe('encodeMultiSend', () => {
    it('should correctly encode a multisend batch (call only)', () => {
      const txs = [
        {
          to: '0x9fe46736679d2d9a65f0992f2272de9f3c7fa6e0',
          data: '0xa9059cbb00000000000000000000000070997970c51812dc3a010c7d01b50e0d17dc79c80000000000000000000000000000000000000000000000000de0b6b3a7640000',
          value: 0n,
        },
        {
          to: '0x9fe46736679d2d9a65f0992f2272de9f3c7fa6e0',
          data: '0xa9059cbb0000000000000000000000003c44cdddb6a900fa2b585dd299e03d12fa4293bc0000000000000000000000000000000000000000000000001bc16d674ec80000',
          value: 0n,
        },
      ] as const

      const MULTI_SEND_CALLONLY_141 =
        '0x9641d764fc13c8b624c04430c7356c1c7c8102e2'

      expect(encodeMultiSend(txs)).toEqual({
        to: MULTI_SEND_CALLONLY_141,
        data: '0x8d80ff0a00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000132009fe46736679d2d9a65f0992f2272de9f3c7fa6e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044a9059cbb00000000000000000000000070997970c51812dc3a010c7d01b50e0d17dc79c80000000000000000000000000000000000000000000000000de0b6b3a7640000009fe46736679d2d9a65f0992f2272de9f3c7fa6e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044a9059cbb0000000000000000000000003c44cdddb6a900fa2b585dd299e03d12fa4293bc0000000000000000000000000000000000000000000000001bc16d674ec800000000000000000000000000000000',
        value: 0n,
        operation: OperationType.DelegateCall,
      })
    })
  })

  it('should correctly encode a multisend batch (with delegate call)', () => {
    const txs = [
      {
        to: '0x9fe46736679d2d9a65f0992f2272de9f3c7fa6e0',
        data: '0xa9059cbb00000000000000000000000070997970c51812dc3a010c7d01b50e0d17dc79c80000000000000000000000000000000000000000000000000de0b6b3a7640000',
        value: 0n,
      },
      {
        to: '0x9fe46736679d2d9a65f0992f2272de9f3c7fa6e0',
        data: '0xa9059cbb0000000000000000000000003c44cdddb6a900fa2b585dd299e03d12fa4293bc0000000000000000000000000000000000000000000000001bc16d674ec80000',
        value: 0n,
        operation: OperationType.DelegateCall,
      },
    ] as const

    const MULTI_SEND_141 = '0x38869bf66a61cf6bdb996a6ae40d5853fd43b526'

    expect(encodeMultiSend(txs)).toEqual({
      to: MULTI_SEND_141,
      data: '0x8d80ff0a00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000132009fe46736679d2d9a65f0992f2272de9f3c7fa6e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044a9059cbb00000000000000000000000070997970c51812dc3a010c7d01b50e0d17dc79c80000000000000000000000000000000000000000000000000de0b6b3a7640000019fe46736679d2d9a65f0992f2272de9f3c7fa6e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044a9059cbb0000000000000000000000003c44cdddb6a900fa2b585dd299e03d12fa4293bc0000000000000000000000000000000000000000000000001bc16d674ec800000000000000000000000000000000',
      value: 0n,
      operation: OperationType.DelegateCall,
    })
  })
})
